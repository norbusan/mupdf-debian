From: Luciano Bello <luciano@debian.org>
Subject: Verify that an xps font could be loaded.
Origin: upstream, http://git.ghostscript.com/?p=mupdf.git;h=ab1a420613dec93c686acbee2c165274e922f82a
Bug-Debian: https://bugs.debian.org/877379
X-CVE: CVE-2017-14685

Index: mupdf-1.9a+ds1/source/xps/xps-link.c
===================================================================
--- mupdf-1.9a+ds1.orig/source/xps/xps-link.c
+++ mupdf-1.9a+ds1/source/xps/xps-link.c
@@ -103,6 +103,8 @@ xps_load_links_in_glyphs(fz_context *ctx
 			bidi_level = atoi(bidi_level_att);
 
 		font = xps_lookup_font(ctx, doc, base_uri, font_uri_att, style_att);
+		if (!font)
+			return;
 		text = xps_parse_glyphs_imp(ctx, doc, &local_ctm, font, fz_atof(font_size_att),
 				fz_atof(origin_x_att), fz_atof(origin_y_att),
 				is_sideways, bidi_level, indices_att, unicode_att);
