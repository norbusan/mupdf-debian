From: Sebastian Rasmussen <sebras@gmail.com>
Date: Wed, 27 Jul 2016 22:19:39 +0800
Subject: Make sure that number of colors in mesh params is valid.

Fixes bug 696954.
---
 source/pdf/pdf-shade.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/source/pdf/pdf-shade.c b/source/pdf/pdf-shade.c
index 40728dc..7e4f3c9 100644
--- a/source/pdf/pdf-shade.c
+++ b/source/pdf/pdf-shade.c
@@ -210,7 +210,7 @@ pdf_load_mesh_params(fz_shade *shade, pdf_document *doc, pdf_obj *dict)
 	obj = pdf_dict_gets(dict, "Decode");
 	if (pdf_array_len(obj) >= 6)
 	{
-		n = (pdf_array_len(obj) - 4) / 2;
+		n = fz_mini(FZ_MAX_COLORS, (pdf_array_len(obj) - 4) / 2);
 		shade->u.m.x0 = pdf_to_real(pdf_array_get(obj, 0));
 		shade->u.m.x1 = pdf_to_real(pdf_array_get(obj, 1));
 		shade->u.m.y0 = pdf_to_real(pdf_array_get(obj, 2));
