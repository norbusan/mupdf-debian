From: Tor Andersson <tor.andersson@artifex.com>
Date: Tue, 19 Sep 2017 16:33:38 +0200
Subject: Fix 698540: Check name, comment and meta size field signs.
Origin: http://git.ghostscript.com/?p=mupdf.git;a=commit;h=0f0fbc07d9be31f5e83ec5328d7311fdfd8328b1
Bug-Debian-Security: https://security-tracker.debian.org/tracker/CVE-2017-14686
Bug-Debian: https://bugs.debian.org/877379
Bug: https://bugs.ghostscript.com/show_bug.cgi?id=698540

---
 source/fitz/unzip.c | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/source/fitz/unzip.c b/source/fitz/unzip.c
index f2d4f322..0bcce0fd 100644
--- a/source/fitz/unzip.c
+++ b/source/fitz/unzip.c
@@ -141,6 +141,9 @@ static void read_zip_dir_imp(fz_context *ctx, fz_zip_archive *zip, int start_off
 		(void) fz_read_int32_le(ctx, file); /* ext file atts */
 		offset = fz_read_int32_le(ctx, file);
 
+		if (namesize < 0 || metasize < 0 || commentsize < 0)
+			fz_throw(ctx, FZ_ERROR_GENERIC, "invalid size in zip entry");
+
 		name = fz_malloc(ctx, namesize + 1);
 		n = fz_read(ctx, file, (unsigned char*)name, namesize);
 		if (n < (size_t)namesize)
-- 
2.11.0

