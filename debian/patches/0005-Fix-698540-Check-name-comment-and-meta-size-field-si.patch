From: Tor Andersson <tor.andersson@artifex.com>
Date: Tue, 19 Sep 2017 16:33:38 +0200
Subject: Fix 698540: Check name, comment and meta size field signs.

---
 source/fitz/unzip.c | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/source/fitz/unzip.c b/source/fitz/unzip.c
index 0e595c0..f906cba 100644
--- a/source/fitz/unzip.c
+++ b/source/fitz/unzip.c
@@ -138,6 +138,9 @@ static void read_zip_dir_imp(fz_context *ctx, fz_zip_archive *zip, int start_off
 		(void) fz_read_int32_le(ctx, file); /* ext file atts */
 		offset = fz_read_int32_le(ctx, file);
 
+		if (namesize < 0 || metasize < 0 || commentsize < 0)
+			fz_throw(ctx, FZ_ERROR_GENERIC, "invalid size in zip entry");
+
 		name = fz_malloc(ctx, namesize + 1);
 		n = fz_read(ctx, file, (unsigned char*)name, namesize);
 		if (n < (size_t)namesize)
